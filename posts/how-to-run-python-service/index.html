<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link type="text/css" rel="stylesheet" href="https://mendelmaleh.gqcss/normalize.css">
  <link type="text/css" rel="stylesheet" href="https://mendelmaleh.gq/sass/simple.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/brands.css" integrity="sha384-n9+6/aSqa9lBidZMRCQHTHKJscPq6NW4pCQBiMmHdUCvPN8ZOg2zJJTkC7WIezWv" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/fontawesome.css" integrity="sha384-vd1e11sR28tEK9YANUtpIOdjGW14pS87bUBuOIoBILVWLFnS+MCX9T6MMf0VdPGq" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i">
  <meta name="generator" content="Hugo 0.55.3" />
  <meta name="theme-color" content="#242933">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body><div class="container">
<h1 class="post-title">How to run a Python service</h1>
<time datetime="2019-04-17T12:46:54-0400">Apr 17, 2019</time>
<p><em>This is how I run my Python bots. This example is valid for CentOS, and it&rsquo;s probably very similar on any other distro. You probably will just need to update the paths.</em></p>

<p>First, add a <code>shebang</code> with the path to <code>python</code> (or <code>python3</code>, whatever you use) to the top of the file:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#!/usr/local/bin/python3 -u</span></code></pre></div>
<p>Then create a <code>bot.service</code> file in <code>/etc/systemd/system</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-ini" data-lang="ini"><span class="k">[Unit]</span>
<span class="c1"># change this to whatever you want</span>
<span class="na">Description</span> <span class="o">=</span> <span class="s">Telegram bot</span>

<span class="k">[Service]</span>
<span class="na">Type</span> <span class="o">=</span> <span class="s">simple</span>
<span class="c1"># change user accordingly</span>
<span class="na">User</span> <span class="o">=</span> <span class="s">mendel</span>
<span class="na">Wants</span> <span class="o">=</span> <span class="s">network.target</span>
<span class="na">After</span> <span class="o">=</span> <span class="s">network.target syslog.target</span>

<span class="na">Restart</span> <span class="o">=</span> <span class="s">on-failure</span>
<span class="na">RestartSec</span> <span class="o">=</span> <span class="s">10</span>
<span class="na">startLimitIntervalSec</span> <span class="o">=</span> <span class="s">60</span>

<span class="c1"># path to python file dir</span>
<span class="na">WorkingDirectory</span> <span class="o">=</span> <span class="s">/home/mendel/python/bot</span>
<span class="c1"># path to python file</span>
<span class="na">ExecStart</span> <span class="o">=</span> <span class="s">/home/mendel/python/bot/main.py</span>
<span class="na">StandardOutput</span> <span class="o">=</span> <span class="s">syslog</span>
<span class="na">StandardError</span> <span class="o">=</span> <span class="s">syslog</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span> <span class="o">=</span> <span class="s">multi-user.target</span></code></pre></div>
<p>Now, to test run <code>sudo systemctl start bot</code>, and you can check status (and any output you print) by doing <code>sudo systemctl -l status bot</code>. <code>-l</code> is not required. You can stop it with <code>sudo systemctl stop bot</code>.</p>

<p><strong><code>bot</code> is merely the name of the <code>.service</code> file, you can change that as you wish.</strong></p>

<p>If everything was good, you can <code>sudo systemctl enable bot</code> to make it start automatically on boot. Obviously there is also a <code>disable</code> command.</p>
<hr class="post-end">
<p>
  <a class="tag" href="https://mendelmaleh.gq/tags/python">python</a>
  <a class="tag" href="https://mendelmaleh.gq/tags/linux">linux</a>
  <a class="tag" href="https://mendelmaleh.gq/tags/systemd">systemd</a>
</p>
</div><footer>
  <script> </script>
</footer>
</body>
</html>
